```mermaid
graph TB
    subgraph "GitHub Copilot Base"
        BASE[Base GitHub Copilot<br/>System Prompt]
    end
    
    subgraph ".github"
        subgraph "agents/"
            ARCH[architecte.md<br/>ğŸ—ï¸ Architecture]
            DEV[developpeur.md<br/>ğŸ’» DÃ©veloppement]
            REV[reviewer.md<br/>ğŸ‘€ Code Review]
        end
        
        subgraph "instructions/"
            CONV[conventions.md<br/>ğŸ“‹ Conventions]
            AZURE[azure-instructions.md<br/>â˜ï¸ Azure]
            PATH[path-based-instructions.md<br/>ğŸ“ Path-Based]
        end
        
        subgraph "knowledge/"
            direction LR
            K_AZURE[azure/<br/>Services & Best Practices]
            K_ARCH[architecture/<br/>Patterns]
        end
        
        subgraph "skills/"
            S_DIAG[diagram-creation/<br/>SKILL.md]
            S_SOL[solution-design/<br/>SKILL.md]
            S_REV[code-review/<br/>SKILL.md]
        end
        
        subgraph "Prompts (Templates)"
            P_BRAIN[brainstorm.prompt<br/>ğŸ’¡ Brainstorming]
            P_TAD[tad.prompt<br/>ğŸ“„ TAD]
            P_COST[cost-estimation.prompt<br/>ğŸ’° CoÃ»ts]
        end
        
        CONFIG[copilot-config.json<br/>âš™ï¸ Configuration]
    end
    
    subgraph "System Prompt Final"
        FINAL[Composition du Prompt]
    end
    
    subgraph "Contexte Runtime"
        WORKSPACE[Workspace Context<br/>Fichiers ouverts]
        TOOLS[Tools Available<br/>Outils MCP]
        USER[User Query<br/>@agent /command]
    end
    
    subgraph "Serveurs MCP"
        MCP1[Azure MCP]
        MCP2[Excel MCP]
        MCP3[GitHub MCP]
    end
    
    %% Flux de composition du prompt
    BASE --> FINAL
    ARCH --> FINAL
    DEV --> FINAL
    REV --> FINAL
    CONV --> FINAL
    AZURE --> FINAL
    PATH --> FINAL
    K_AZURE -.RAG.-> FINAL
    K_ARCH -.RAG.-> FINAL
    WORKSPACE --> FINAL
    TOOLS --> FINAL
    
    %% Configuration
    CONFIG --> MCP1
    CONFIG --> MCP2
    CONFIG --> MCP3
    
    MCP1 --> TOOLS
    MCP2 --> TOOLS
    MCP3 --> TOOLS
    
    %% Skills liÃ©es aux agents
    ARCH -.utilise.-> S_DIAG
    ARCH -.utilise.-> S_SOL
    DEV -.utilise.-> S_REV
    REV -.utilise.-> S_REV
    
    %% Prompts accessibles
    P_BRAIN -.template.-> FINAL
    P_TAD -.template.-> FINAL
    P_COST -.template.-> FINAL
    
    %% User interaction
    USER --> FINAL
    FINAL --> RESPONSE[ğŸ¤– RÃ©ponse Copilot]
    
    style BASE fill:#e1f5ff
    style FINAL fill:#fff4e6
    style RESPONSE fill:#e8f5e9
    style CONFIG fill:#f3e5f5
    style USER fill:#fff9c4
    
    classDef agent fill:#bbdefb
    classDef instruction fill:#c8e6c9
    classDef knowledge fill:#ffecb3
    classDef skill fill:#f8bbd0
    classDef prompt fill:#d1c4e9
    classDef mcp fill:#b2dfdb
    
    class ARCH,DEV,REV agent
    class CONV,AZURE,PATH instruction
    class K_AZURE,K_ARCH knowledge
    class S_DIAG,S_SOL,S_REV skill
    class P_BRAIN,P_TAD,P_COST prompt
    class MCP1,MCP2,MCP3 mcp
```

## ğŸ“Š LÃ©gende

### Composants

- **ğŸ”µ Base GitHub Copilot**: Prompt systÃ¨me de base non modifiable
- **ğŸŸ¦ Agents**: DÃ©finissent les personnalitÃ©s et rÃ´les
- **ğŸŸ© Instructions**: Instructions contextuelles chargÃ©es selon les conditions
- **ğŸŸ¨ Knowledge**: Base de connaissances statique (RAG)
- **ğŸŸ¥ Skills**: CompÃ©tences actives dÃ©finissant les actions
- **ğŸŸª Prompts**: Templates rÃ©utilisables
- **ğŸŸ¢ MCP Servers**: Serveurs d'outils externes

### Flux

1. **Composition SÃ©quentielle** (â†’): Ordre de composition du prompt
   - Base â†’ Agents â†’ Instructions â†’ Knowledge â†’ Context â†’ Tools

2. **RÃ©cupÃ©ration RAG** (-.->): Knowledge rÃ©cupÃ©rÃ©e dynamiquement

3. **Utilisation** (-.-): Relations d'utilisation entre composants

### Ordre de Composition du System Prompt

```
1. Base GitHub Copilot (non modifiable)
   â†“
2. Agent Instructions (agents/*.md)
   â†“
3. Path-based Instructions (si workspace match)
   â†“
4. Knowledge Chunks (via RAG)
   â†“
5. Workspace Context (fichiers ouverts)
   â†“
6. Tools Available (liste des outils MCP)
   â†“
7. User Query (@agent /command)
   â†“
8. ğŸ¤– RÃ©ponse Copilot
```

## ğŸ”„ Exemples d'Utilisation

### Exemple 1: @architecte /diagramme
```
User: @architecte /diagramme
  â†“
Charge: architecte.md (personnalitÃ©)
  â†“
Utilise: diagram-creation/SKILL.md (compÃ©tence)
  â†“
RÃ©cupÃ¨re: architecture/patterns.md (knowledge)
  â†“
Applique: conventions.md (instructions)
  â†“
GÃ©nÃ¨re: Diagramme d'architecture
```

### Exemple 2: Travail sur /src/frontend/
```
Context: Fichier dans /src/frontend/
  â†“
Charge: path-based-instructions.md
  â†“
Applique: Instructions Frontend React
  â†“
Utilise: conventions.md
  â†“
Code gÃ©nÃ©rÃ© selon le contexte
```

### Exemple 3: Utilisation d'un Prompt File
```
User: #brainstorm.prompt
  â†“
Charge: Template brainstorm.prompt
  â†“
Applique: Instructions du prompt
  â†“
Session de brainstorming guidÃ©e
```
